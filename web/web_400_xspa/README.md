# Открытка

### Сложность: 400
### Категория: web

### Описание:

Отправьте открытку своим друзьям. А так же не забудьте отправить лидеру Казахстана Оо
Формат флага: начинается с решетки (#)

### Хинты:

1. Если интересно, там используется ElasticSearch, но это мало чем поможет, если вы не поняли сами :)
2. В Elastic ваши данные не идут. Они статичны, неизменны и помогают вам найти Резиденцию Президента. Больше баз данных не используется
3. Если, ваши переходы не сохраняются в бд, но доступны всегда по одной ссылке, то где они?

### Решение:

~~~~
Автор - ленивый человек, поэтому за writeup выражает благодарность Дмитрию @mukovkin
Я лишь внесу небольшие корректировки.
~~~~

В веб 400 оновная идея, что порт базы данных не висит наружу. 
Следовательно, необходимо найти способ заглянуть внутрь.
Изначально на главной странице есть 2 ссылки на файл: открытие картинок, через параметр url (redirecter.php) и поиск по базе данных(search.php).
Если в параметр url вставить какую-нибудь ссылку (например http://vk.com), то .... откроется сайт!

**Работаем с web-proxy, делаем вывод о XSPA**

После того файл redirecter перекинет на путь вида redirecter.php?aqwsedrftg=12331231323, то можно предположить, что файл сохраняется где-то локально и какой-то параметр отвечает за путь.
Все верно.  Можно сделать так: 
~~~~
http://193.218.139.203/redirecter.php?eeckacoboo=../redirecter.php
~~~~
И мы получим исходный код redirecter.php!
Открываем файлы search.php, functions.php, видим, что используется ElasticSearch её нестандартный порт, а так же index, tag.
Дальше делаем запрос вида 
~~~~
http://193.218.139.203/redirecter.php?url=http://localhost:48627/jaqioalgqe/
~~~~
И нам доступна БД. 
Теперь есть подсказка про резиденцию Назарбаева. 
Находим через поиск идентификатор адреса резиденции президента (Передается id:строка адреса). 
А потом ищем его в базе
~~~~
http://193.218.139.203/redirecter.php?url=http://localhost:48627/jaqioalgqe/aiwoknqefi/412544
~~~~
Флаг - #Us3nDm3ss4g3t0MR_president